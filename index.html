<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Black-Scholes Option Pricer</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #1e3c50, #274a5e);
      color: #fff;
      padding: 30px;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }
    input, select {
      padding: 5px;
      margin-bottom: 10px;
      width: 200px;
      display: block;
    }
    button {
      padding: 10px 15px;
      background-color: #28a745;
      color: white;
      border: none;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>Black-Scholes Option Pricer</h1>

  <label>Stock Price: <input id="stockPrice" value="100" /></label>
  <label>Strike Price: <input id="strikePrice" value="90" /></label>
  <label>Time to Maturity (years): <input id="maturity" value="1" /></label>
  <label>Interest Rate: <input id="interestRate" value="0.05" /></label>
  <label>Volatility: <input id="volatility" value="0.2" /></label>
  <label>Option Type: 
    <select id="optionType">
      <option value="Call">Call</option>
      <option value="Put">Put</option>
    </select>
  </label>

  <button onclick="calculateOption()">Calculate</button>
  <button id="heatmapBtn">Show Heat Map</button>

  <h3 id="result"></h3>

  <h3>Heatmap (Strike vs Volatility)</h3>
  <div id="heatmap" style="width: 700px; height: 500px;"></div>

  <script>
    const API_URL = "https://black-scholes-api-w8et.onrender.com/option_price";

    function calculateOption() {
      const data = getFormData();

      fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(result => {
        document.getElementById("result").innerText = `Option Price: $${parseFloat(result.price).toFixed(2)}`;
      })
      .catch(err => console.error(err));
    }

    function getFormData() {
      return {
        S: parseFloat(document.getElementById("stockPrice").value),
        K: parseFloat(document.getElementById("strikePrice").value),
        T: parseFloat(document.getElementById("maturity").value),
        r: parseFloat(document.getElementById("interestRate").value),
        sigma: parseFloat(document.getElementById("volatility").value),
        option_type: document.getElementById("optionType").value
      };
    }

    document.getElementById("heatmapBtn").addEventListener("click", () => {
      const S = parseFloat(document.getElementById("stockPrice").value);
      const T = parseFloat(document.getElementById("maturity").value);
      const r = parseFloat(document.getElementById("interestRate").value);
      const option_type = document.getElementById("optionType").value;

      const strikes = [];
      const vols = [];

      for (let k = 80; k <= 120; k += 5) strikes.push(k);
      for (let v = 0.1; v <= 0.5; v += 0.05) vols.push(parseFloat(v.toFixed(2)));

      const zData = [];
      let completed = 0;

      for (let i = 0; i < vols.length; i++) {
        zData[i] = [];
        for (let j = 0; j < strikes.length; j++) {
          const K = strikes[j];
          const sigma = vols[i];

          fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ S, K, T, r, sigma, option_type })
          })
          .then(res => res.json())
          .then(data => {
            zData[i][j] = parseFloat(data.price.toFixed(2));
            completed++;

            if (completed === vols.length * strikes.length) {
              Plotly.newPlot("heatmap", [{
                z: zData,
                x: strikes,
                y: vols,
                type: "heatmap",
                colorscale: "Viridis"
              }], {
                title: "Option Price Heatmap",
                xaxis: { title: "Strike Price" },
                yaxis: { title: "Volatility" }
              });
            }
          })
          .catch(err => console.error("Error fetching data", err));
        }
      }
    });
  </script>
</body>
</html>
